#!/usr/bin/env python3
"""
ะะพะฟะพะปะฝะธัะตะปัะฝัะต ััะฝะบัะธะธ ะดะปั Warmly Bot
"""

import random
from datetime import datetime, timedelta
from typing import List, Dict

# ะะพะปะปะตะบัะธั ะผะพัะธะฒะฐัะธะพะฝะฝัั ััะฐะท ะฟะพ ะบะฐัะตะณะพัะธัะผ
MOTIVATION_CATEGORIES = {
    'morning': [
        "ะะพะฑัะพะต ัััะพ! ๐ ะขั ัะถะต ัะดะตะปะฐะป ัะฐะผะพะต ัะปะพะถะฝะพะต โ ะฟัะพัะฝัะปัั.",
        "ะะพะฒัะน ะดะตะฝั โ ะฝะพะฒัะต ะฒะพะทะผะพะถะฝะพััะธ! โจ",
        "ะขั ะฟัะพัะฝัะปัั, ะธ ััะพ ัะถะต ะฟะพะฑะตะดะฐ! ๐",
        "ะกะตะณะพะดะฝั ะฑัะดะตั ัะพัะพัะธะน ะดะตะฝั, ะฟะพัะพะผั ััะพ ัั ะฒ ะฝะตะผ! ๐ซ",
        "ะขั ะณะพัะพะฒ ะฟะพะบะพัััั ััะพั ะดะตะฝั! ๐ช"
    ],
    'evening': [
        "ะกะฟะพะบะพะนะฝะพะน ะฝะพัะธ! ๐ ะขั ะทะฐัะปัะถะธะฒะฐะตัั ัะพัะพัะตะณะพ ะพัะดััะฐ.",
        "ะขั ะฟัะพัะตะป ัะตัะตะท ััะพั ะดะตะฝั โ ะณะพัะดะธัั ัะพะฑะพะน! ๐",
        "ะะฐะฒััะฐ ะฑัะดะตั ะฝะพะฒัะน ัะฐะฝั ะฑััั ะตัะต ะปัััะต! โจ",
        "ะขั ัะดะตะปะฐะป ะฒัะต, ััะพ ะผะพะณ ัะตะณะพะดะฝั โ ััะพ ะดะพััะฐัะพัะฝะพ! ๐",
        "ะัะดััะฐะน ัะพัะพัะพ, ัั ััะพ ะทะฐัะปัะถะธะป! ๐ด"
    ],
    'encouragement': [
        "ะขั ัะธะปัะฝะตะต, ัะตะผ ะดัะผะฐะตัั! ๐ช",
        "ะะฐะถะดัะน ะดะตะฝั โ ััะพ ะฝะพะฒัะน ัะฐะฝั! ๐ฑ",
        "ะขั ะฝะต ะพะดะธะฝ ะฒ ัะฒะพะธั ะฟะตัะตะถะธะฒะฐะฝะธัั! ๐ค",
        "ะขะฒะพั ัะตะฝะฝะพััั ะฝะต ะทะฐะฒะธัะธั ะพั ัะฒะพะธั ะดะพััะธะถะตะฝะธะน! ๐",
        "ะขั ะทะฐัะปัะถะธะฒะฐะตัั ะปัะฑะฒะธ ะฟัะพััะพ ะฟะพัะพะผั, ััะพ ัััะตััะฒัะตัั! โค๏ธ"
    ],
    'difficult_times': [
        "ะขััะดะฝัะต ะฒัะตะผะตะฝะฐ ะฝะต ะดะปัััั ะฒะตัะฝะพ, ะฝะพ ัะธะปัะฝัะต ะปัะดะธ โ ะดะฐ! ๐ช",
        "ะขั ะฟะตัะตะถะธะฒะฐะป ัััะดะฝะพััะธ ัะฐะฝััะต ะธ ัะฟัะฐะฒะธะปัั โ ัะฟัะฐะฒะธัััั ะธ ัะตะนัะฐั! ๐",
        "ะญัะพ ัะพะถะต ะฟัะพะนะดะตั, ะฐ ัั ััะฐะฝะตัั ัะธะปัะฝะตะต! โก",
        "ะขั ะฝะต ะพะดะธะฝ โ ะผะฝะพะณะธะต ะฟัะพัะพะดะธะปะธ ัะตัะตะท ััะพ! ๐ค",
        "ะะฐะถะดะฐั ัััะดะฝะพััั ะดะตะปะฐะตั ัะตะฑั ะผัะดัะตะต! ๐ง"
    ],
    'self_love': [
        "ะขั ะทะฐัะปัะถะธะฒะฐะตัั ะปัะฑะฒะธ, ะพัะพะฑะตะฝะฝะพ ะพั ัะฐะผะพะณะพ ัะตะฑั! ๐",
        "ะัะดั ะดะพะฑั ะบ ัะตะฑะต โ ัั ััะพ ะทะฐัะปัะถะธะป! ๐ค",
        "ะขะฒะพั ัะฝะธะบะฐะปัะฝะพััั โ ััะพ ัะฒะพั ััะฟะตััะธะปะฐ! โก",
        "ะขั ะดะพััะฐัะพัะฝะพ ัะพัะพั ะธะผะตะฝะฝะพ ัะฐะบะธะผ, ะบะฐะบะพะน ะตััั! โจ",
        "ะัะฑะธ ัะตะฑั โ ัั ะตะดะธะฝััะฒะตะฝะฝัะน, ะบัะพ ะฑัะดะตั ั ัะพะฑะพะน ะฒัั ะถะธะทะฝั! ๐"
    ]
}

# ะคัะฐะทั ะดะปั ัะฐะทะฝัั ะฒัะตะผะตะฝ ะณะพะดะฐ
SEASONAL_PHRASES = {
    'spring': [
        "ะะตัะฝะฐ โ ะฒัะตะผั ะฝะพะฒัั ะฝะฐัะธะฝะฐะฝะธะน! ๐ธ",
        "ะะฐะบ ะฟัะธัะพะดะฐ ะฟัะพะฑัะถะดะฐะตััั, ัะฐะบ ะธ ัั ะผะพะถะตัั ะฝะฐัะฐัั ะทะฐะฝะพะฒะพ! ๐ฑ",
        "ะะตัะตะฝะฝะตะต ัะพะปะฝัะต ัะพะณัะตะฒะฐะตั ะดััั! โ๏ธ"
    ],
    'summer': [
        "ะะตัะฝะตะต ัะพะปะฝัะต ะฝะฐะฟะพะปะฝัะตั ัะฝะตัะณะธะตะน! โ๏ธ",
        "ะะตัะพ โ ะฒัะตะผั ัะฐะดะพััะธ ะธ ััะฐัััั! ๐ป",
        "ะขะตะฟะปัะต ะดะฝะธ, ัะตะฟะปัะต ะผััะปะธ! ๐"
    ],
    'autumn': [
        "ะัะตะฝั โ ะฒัะตะผั ัะฑะพัะฐ ััะพะถะฐั ะธ ะฟะพะดะฒะตะดะตะฝะธั ะธัะพะณะพะฒ! ๐",
        "ะะฐะบ ะปะธัััั ะผะตะฝััั ัะฒะตั, ัะฐะบ ะธ ัั ะผะพะถะตัั ะธะทะผะตะฝะธัััั! ๐",
        "ะัะตะฝะฝัั ะผัะดัะพััั ะฒ ะบะฐะถะดะพะผ ะดะฝะต! ๐ฆ"
    ],
    'winter': [
        "ะะธะผะฐ โ ะฒัะตะผั ะฟะพะบะพั ะธ ัะฐะทะผััะปะตะฝะธะน! โ๏ธ",
        "ะะฐะบ ัะฝะตะณ ัะบััะฒะฐะตั ะทะตะผะปั, ัะฐะบ ะธ ัั ะผะพะถะตัั ัะบัััััั ัะตะฟะปะพะผ! ๐งฃ",
        "ะะธะผะฝะธะต ะฒะตัะตัะฐ ะธะดะตะฐะปัะฝั ะดะปั ะทะฐะฑะพัั ะพ ัะตะฑะต! ๐ฏ๏ธ"
    ]
}

def get_seasonal_phrase() -> str:
    """ะะพะปััะธัั ััะฐะทั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฒัะตะผะตะฝะธ ะณะพะดะฐ"""
    month = datetime.now().month
    if month in [12, 1, 2]:
        season = 'winter'
    elif month in [3, 4, 5]:
        season = 'spring'
    elif month in [6, 7, 8]:
        season = 'summer'
    else:
        season = 'autumn'
    
    return random.choice(SEASONAL_PHRASES[season])

def get_time_based_phrase() -> str:
    """ะะพะปััะธัั ััะฐะทั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฒัะตะผะตะฝะธ ะดะฝั"""
    hour = datetime.now().hour
    
    if 5 <= hour < 12:
        return random.choice(MOTIVATION_CATEGORIES['morning'])
    elif 18 <= hour < 23:
        return random.choice(MOTIVATION_CATEGORIES['evening'])
    else:
        return random.choice(MOTIVATION_CATEGORIES['encouragement'])

def get_personalized_phrase(user_name: str, streak_days: int = 0) -> str:
    """ะะพะปััะธัั ะฟะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝัั ััะฐะทั"""
    base_phrases = [
        f"ะัะธะฒะตั, {user_name}! ะขั ะทะฐะผะตัะฐัะตะปัะฝัะน! ๐",
        f"{user_name}, ัั ะดะตะปะฐะตัั ะผะธั ะปัััะต! ๐",
        f"ะขั ะฒะฐะถะตะฝ, {user_name}! ะะต ะทะฐะฑัะฒะฐะน ะพะฑ ััะพะผ! โจ"
    ]
    
    if streak_days > 0:
        streak_phrases = [
            f"ะะฐั, {user_name}! {streak_days} ะดะฝะตะน ะฟะพะดััะด โ ััะพ ะฒะฟะตัะฐัะปัััะต! ๐ฅ",
            f"{user_name}, ัะฒะพั ัะตัะธั ะฒ {streak_days} ะดะฝะตะน ะฒะดะพัะฝะพะฒะปัะตั! ๐ช",
            f"ะขั ะฝะตะฒะตัะพััะฝัะน, {user_name}! {streak_days} ะดะฝะตะน ะฟะพะดััะด! ๐"
        ]
        return random.choice(streak_phrases)
    
    return random.choice(base_phrases)

def get_mood_encouragement(mood: str, streak_days: int = 0) -> str:
    """ะะพะปััะธัั ะพะฑะพะดััััะตะต ัะพะพะฑัะตะฝะธะต ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะฝะฐัััะพะตะฝะธั"""
    encouragements = {
        'excellent': [
            "ะขั ัะธัะตัั! ะะพะดะตะปะธัั ััะธะผ ัะฒะตัะพะผ ั ะผะธัะพะผ! โจ",
            "ะขะฐะบะพะต ะฝะฐัััะพะตะฝะธะต ะทะฐัะฐะทะธัะตะปัะฝะพ! ะัะพะดะพะปะถะฐะน! ๐",
            "ะขั ะฒะดะพัะฝะพะฒะปัะตัั ะดััะณะธั ัะฒะพะธะผ ะฟะพะทะธัะธะฒะพะผ! ๐ซ"
        ],
        'good': [
            "ะัะปะธัะฝะพ! ะกะพััะฐะฝะธ ััะพ ััะฒััะฒะพ! ๐",
            "ะฅะพัะพัะตะต ะฝะฐัััะพะตะฝะธะต โ ััะพ ะฟะพะดะฐัะพะบ! ๐",
            "ะขั ะทะฐัะปัะถะธะฒะฐะตัั ััะพะณะพ ัะพัะพัะตะณะพ ะฝะฐัััะพะตะฝะธั! ๐"
        ],
        'ok': [
            "ะะพัะผะฐะปัะฝะพ โ ััะพ ัะพะถะต ะฝะพัะผะฐะปัะฝะพ! ๐",
            "ะะฝะพะณะดะฐ ะฟัะพััะพ ะฑััั ะฒ ะฟะพััะดะบะต โ ััะพ ัะถะต ะผะฝะพะณะพ! ๐ค",
            "ะขั ัะฟัะฐะฒะปัะตัััั! ะญัะพ ะฒะฐะถะฝะพ! ๐ช"
        ],
        'bad': [
            "ะขััะดะฝัะต ะดะฝะธ ะฟัะพัะพะดัั, ะฝะพ ัั ะพััะฐะตัััั ัะธะปัะฝัะผ! ๐ช",
            "ะขั ะฝะต ะพะดะธะฝ ะฒ ัะฒะพะธั ะฟะตัะตะถะธะฒะฐะฝะธัั! ๐ค",
            "ะะฐะฒััะฐ ะฑัะดะตั ะปัััะต! ะะตัั ะฒ ััะพ! ๐"
        ],
        'terrible': [
            "ะขั ะฟะตัะตะถะธะฒะฐะตัั ัััะดะฝัะต ะฒัะตะผะตะฝะฐ, ะฝะพ ัั ัะธะปัะฝะตะต ััะพะณะพ! ๐ช",
            "ะญัะพ ะฟัะพะนะดะตั, ะฐ ัั ััะฐะฝะตัั ะตัะต ัะธะปัะฝะตะต! โก",
            "ะขั ะฝะต ะพะดะธะฝ! ะะฝะพะณะธะต ะฟัะพัะพะดะธะปะธ ัะตัะตะท ััะพ! ๐ค"
        ]
    }
    
    base_encouragement = random.choice(encouragements.get(mood, encouragements['ok']))
    
    if streak_days > 1:
        return f"{base_encouragement}\n\n๐ฅ ะััะฐัะธ, ั ัะตะฑั ัะถะต {streak_days} ะดะฝะตะน ะฟะพะดััะด! ะขั ะผะพะปะพะดะตั!"
    
    return base_encouragement

def get_achievement_message(streak_days: int) -> str:
    """ะะพะปััะธัั ัะพะพะฑัะตะฝะธะต ะพ ะดะพััะธะถะตะฝะธะธ"""
    achievements = {
        3: "๐ 3 ะดะฝั ะฟะพะดััะด! ะขั ัะพะทะดะฐะตัั ะฟัะธะฒััะบั!",
        7: "๐ ะะตะดะตะปั ะฟะพะดััะด! ะขั ะฝะตะฒะตัะพััะฝัะน!",
        14: "๐ 2 ะฝะตะดะตะปะธ! ะขั ะฒะดะพัะฝะพะฒะปัะตัั!",
        30: "๐ ะะตััั ะฟะพะดััะด! ะขั ะปะตะณะตะฝะดะฐ!",
        100: "๐ 100 ะดะฝะตะน! ะขั ะผะฐััะตั ะฟัะธะฒััะตะบ!",
        365: "๐ ะะพะด ะฟะพะดััะด! ะขั ะฐะฑัะพะปััะฝัะน ัะตะผะฟะธะพะฝ!"
    }
    
    # ะะฐัะพะดะธะผ ะฑะปะธะถะฐะนัะตะต ะดะพััะธะถะตะฝะธะต
    for milestone in sorted(achievements.keys(), reverse=True):
        if streak_days >= milestone:
            return achievements[milestone]
    
    return f"๐ฅ {streak_days} ะดะฝะตะน ะฟะพะดััะด! ะัะพะดะพะปะถะฐะน ะฒ ัะพะผ ะถะต ะดััะต!"

def get_daily_reminder() -> str:
    """ะะพะปััะธัั ะตะถะตะดะฝะตะฒะฝะพะต ะฝะฐะฟะพะผะธะฝะฐะฝะธะต"""
    reminders = [
        "ะะต ะทะฐะฑัะฒะฐะน: ัั ะดะพััะฐัะพัะฝะพ ัะพัะพั! ๐",
        "ะขั ะทะฐัะปัะถะธะฒะฐะตัั ะปัะฑะฒะธ ะธ ะทะฐะฑะพัั! ๐ค",
        "ะขะฒะพะธ ััะฒััะฒะฐ ะฒะฐะถะฝั! โจ",
        "ะขั ะฝะต ะดะพะปะถะตะฝ ะฑััั ะธะดะตะฐะปัะฝัะผ! ๐ซ",
        "ะัะดั ะดะพะฑั ะบ ัะตะฑะต ัะตะณะพะดะฝั! ๐"
    ]
    
    return random.choice(reminders)

def get_weekly_summary(mood_stats: Dict, total_days: int) -> str:
    """ะะพะปััะธัั ะตะถะตะฝะตะดะตะปัะฝัั ัะฒะพะดะบั"""
    if not mood_stats:
        return "ะะฐ ััะพะน ะฝะตะดะตะปะต ะฟะพะบะฐ ะฝะตั ะทะฐะฟะธัะตะน ะพ ะฝะฐัััะพะตะฝะธะธ. ะะฐัะฝะธ ะพััะปะตะถะธะฒะฐัั! ๐"
    
    # ะะฐัะพะดะธะผ ะฟัะตะพะฑะปะฐะดะฐััะตะต ะฝะฐัััะพะตะฝะธะต
    dominant_mood = max(mood_stats.items(), key=lambda x: x[1])
    mood_emoji = {'excellent': '๐', 'good': '๐', 'ok': '๐', 'bad': '๐', 'terrible': '๐ข'}.get(dominant_mood[0], '๐')
    
    summary = f"๐ ะขะฒะพั ะฝะตะดะตะปั:\n\n"
    summary += f"๐ ะัะตะณะพ ะทะฐะฟะธัะตะน: {total_days}\n"
    summary += f"๐ฏ ะัะฝะพะฒะฝะพะต ะฝะฐัััะพะตะฝะธะต: {mood_emoji} {dominant_mood[0].capitalize()} ({dominant_mood[1]} ัะฐะท)\n\n"
    
    # ะะพะฑะฐะฒะปัะตะผ ะพะฑะพะดััััะตะต ัะพะพะฑัะตะฝะธะต
    if dominant_mood[0] in ['excellent', 'good']:
        summary += "ะัะปะธัะฝะฐั ะฝะตะดะตะปั! ะขั ะผะพะปะพะดะตั! ๐"
    elif dominant_mood[0] == 'ok':
        summary += "ะกัะฐะฑะธะปัะฝะฐั ะฝะตะดะตะปั โ ััะพ ัะพะถะต ัะพัะพัะพ! ๐ช"
    else:
        summary += "ะขััะดะฝะฐั ะฝะตะดะตะปั, ะฝะพ ัั ัะฟัะฐะฒะธะปัั! ะขั ัะธะปัะฝัะน! ๐ช"
    
    return summary